<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<style>

			iframe {
				opacity: 0;
				transition: opacity 10s;
			}

			.fadeIn {
				opacity: 1;
			}
			.fadeOut {
				opacity: 0;
			}
			.hidden {
				display: none;
			}

			body {
				padding: 0;
				margin: 0;
				background-color: black;
			}
		</style>
	</head>
	<body>
  <!-- 
		<iframe width="100%" height="100%" src="https://www.youtube.com/embed/ffxKSjUwKdU?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
		<iframe width="100%" height="100%" src="https://www.youtube.com/embed/tGRzz0oqgUE?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
		<iframe width="100%" height="100%" src="https://www.youtube.com/embed/OQitfe8u7i4?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe> -->
		<script type="text/javascript">
			/*
			crossfadeTime = 5000;

			function fadeIn(iframe) {
				iframe.addClass('fadeIn');
			}
			function fadeOut(iframe) {
				iframe.addClass('fadeOut');
			}

			function stopSong(iframe) {
				src = iframe.attr('src');
				iframe.attr('src', src.split('&autoplay')[0]);
			}

			function startSong(iframe) {
				src = iframe.attr('src');
				iframe.attr('src', src + "&autoplay=1");
			}

			function fadeBetweenIframes(iframe1, iframe2) {
				loadDelay = 3000; // Autoplaying a video will load it, doesn't happen instantly
				// We want to start the new song so it will load, but delay the fade in until it's loaded enough
				startSong(iframe2);

				setTimeout(function() {
					fadeOut(iframe1);
				}, loadDelay);

				setTimeout(function() {
					stopSong(iframe1);
				}, loadDelay + crossfadeTime);

				setTimeout(function() {
					fadeIn(iframe2);
				}, loadDelay);
			}

			iframes = $('iframe');
			currentSong = 0;
			iframes.each(function() {
				$(this).css('position', 'absolute');
				$(this).css('left', 0);
			});
			startSong($(iframes[currentSong]));

			setTimeout(function() {
				fadeBetweenIframes($(iframes[currentSong]), $(iframes[currentSong + 1]));
			}, 20000);

			setTimeout(function() {
				fadeBetweenIframes($(iframes[currentSong + 1]), $(iframes[currentSong + 2]));
			}, 20000 * 2 + crossfadeTime);

			//$(iframes[currentSong]).css('opacity', 1);
			fadeIn($(iframes[currentSong]));*/
		</script>

		<!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>

    <script>

    	// When debug is on, the videos appear stacked instead of on top of eachother, for easier viewing of the transitions
    	DEBUG = false;

      var storedPlaylist = window.localStorage.getItem('songList');
      var songs;
      if (storedPlaylist) {
        songs = JSON.parse(storedPlaylist);
      } else {
        songs = [
        {
          id: 'pa14VNsdSYM',  // Rihanna Only Girl In The World
          startTime: 15
        },
        {
          id: 'k5TqNsr6YuQ',  // Troye Sivan My My My
          startTime: 10
        },
        {
          id: 'LXXQLa-5n5w',  // Beyonce Pretty Hurts
          startTime: 120
        },
        {
          id: '2XY3AvVgDns'  // Beyonce Countdown
        },
        {
          id: 'QeWBS0JBNzQ'  // Lady Gaga Edge Of Glory
        },
        {
          id: 'EBt_88nxG4c', // P!nk Beautiful Trauma
          startTime: 15,
          endTime: 210
        },
        {
          id: 'dMK_npDG12Q'  // Lorde Green Light
        },
        {
          id: 'J0DjcsK_-HY',  // Lorde Perfect Places
          startTime: 40
        },
        {
          id: '41PTANtZFW0'  // Troye Sivan Bloom
        },
        {
          id: 'mPRy1B4t5YA'  // Charlie XCX Boys
        },
        {
          id: 'E2Q52cVx7Bo' // Gorillaz Tranz
        },
        {
          id: 'F1B9Fk_SgI0',  // Childish Gambino Feels Like Summer
          startTime: 15
        },
        {
          id: '1DhA69K3fZ4'  // Shakira Clandestino
        },
        {
          id: 'sPTn0QEhxds'  // Shakira Me Enamore
        },
        {
          id: 'LryQJ25CnKU',  // Jennifer Lopez El Anillo
          startTime: 47
        },
        {
          id: 'voG07pt-KYI', // Zayn Entertainer
          startTime: 10
        },
        {
          id: 'kHLHSlExFis'  // Ariana Grande God Is A Woman
        },
        {
          id: 'WZzcY7ASQno'  // Marina and the Diamonds Froot
        },
        {
          id: 'TeccAtqd5K8'  // CRJ Run Away With Me
        },
        {
          id: 'o97_jDomyqc',  // CRJ Cut To The Feeling
          startTime: 20
        },
        {
          id: 'b1LNQBX8JwE'  // CRJ Boy Problems
        },
        {
          id: '6SuMbFuKDf8'  // Backstreet Boys Dont Go Breaking My Heart
        },
        {
          id: 'VkXjvHfP3MM',  // Nicki Minaj No Frauds
          startTime: 20
        },
        {
          id: 'WDZJPJV__bQ'  // Beyonce Formation
        },
        {
          id: 'kbMqWXnpXcA',  // The Carters APESHIT
          startTime: 37
        },
        {
          id: 'eMymSXUN9nQ',  // Nicki Minaj Ganja Burns
          startTime: 52
        },
        {
          id: 'jdH2Sy-BlNE', // Janelle Monae Crazy Classic Life
          startTime: 300,
          endTime: 510
        },
        {
          id: 'jdH2Sy-BlNE', // Janelle Monae Screwed
          startTime: 925,
          endTime: 1110
        },
        {
          id: 'OQitfe8u7i4' // Ariana Grande The Light Is Coming
        },
        {
          id: 'ffxKSjUwKdU'  // Ariana Grande No Tears Left To Cry
        },
        {
          id: 'e1YqueG2gtQ',  // Chvrches Miracle
          startTime: 8
        },
        {
          id: 'vwFVDxDIvHg',  // Years & Years All For You
          endTime: 210
        },
        {
          id: 'X8sSXU-J8fI'  // Ozuna La Modelo
        },
        {
          id: '9jI-z9QN6g8'  // Te Bote Remix
        },
        {
          id: 'aEM2kOrrNJI'  // Jennifer Lopez Dinero
        },
        {
          id: '3ATQvgkXT9E'  // Farruko Krippy Kush
        },
        {
          id: 'NB3gWkhLkxM', // The Internet Come Over
          endTime: 270
        },
        {
          id: 'YynKelHGhNc', // Hayley Kiyoko What I Need
          startTime: 45,
          endTime: 300
        },
        {
          id: 'TV-_Yuc228s', // Hayley Kiyoko Feelings
          startTime: 70,
          endTime: 270
        },
        {
          id: 'F6ImxY6hnfA'  // Robyn Call Your Girlfriend
        },
        {
          id: 'CcNo07Xp8aQ'  // Robyn Dancing On My Own
        },
        {
          id: 'skOAT87JVbU'  // Years & Years Meteorite
        },
        {
          id: '7T4rz4NsYjk'  // Cher SOS
        },
        {
          id: 'bhxhNIQBKJI',  // Troye Sivan Dance To This
          startTime: 15
        },
        {
          id: 'xTlNMmZKwpA'  // Cardi B I Like It
        },
        {
          id: 'hXnMSaK6C2w',  // Cardi B Bartier Cardi
          startTime: 20
        },
        {
          id: 'mTjQq5rMlEY'  // Janelle Monae Django Jane
        },
        {
          id: 'tGRzz0oqgUE',  // Janelle Monae Make Me Feel
          startTime: 30,
        },
        {
          id: 'seh_fZJqB94'  // Janet Jackson Made For Now
        },
        {
          id: 'YqvCptqhHfs',  // Travis Scott Stop Tryna Be God
          startTime: 15
        },
        {
          id: 'tvTRZJ-4EyI'  // Kendrick Lamar Humble
        },
        {
          id: 'au2n7VVGv_c'  // Post Malone Psycho
        },
        {
          id: 'uovntV3ZMDc', // Janelle Monae I Like That
        },
        {
          id: 'cggNqDAtJYU',  // Lady Gaga Marry The Night
          startTime: 450,
          endTime: 785
        },
        {
          id: 'Xn599R0ZBwg'  // Lady Gaga Perfect Illusion
        },
        {
          id: 'YjtsaXwDcF0'  // Nicki Minaj Feelin Myself
        },
        {
          id: 'v8eulIH7tU0'  // Christine and the Queens 5 Dollars
        },
        {
          id: 'WLUDxVezNes',  // Tegan and Sara Stop Desire
          endTime: 180
        },
        {
          id: 'FTQbiNvZqaY'  // Toto Africa
        },
        {
          id: 'JQbjS0_ZfJ0' // Kendrick Lamar All The Stars
        },
        {
          id: 'zxtl5ExJmag',  // Nicki Minaj Bed
          startTime: 20
        },
        {
          id: 'gDr7aTfBffU',  // Marina and the Diamonds Blue
          startTime: 20
        },
        {
          id: 'PaYvlVR_BEc',  // Janelle Monae Pynk
          startTime: 20
        },
        {
          id: 'tEddixS-UoU',  // Janelle Monae QUEEN
          startTime: 53
        },
        {
          id: 'ClU3fctbGls', // P!nk What About Us
          startTime: 40,
          endTime: 300
        },
        {
          id: 'k2qgadSvNyU',  // Dua Lipa New Rules
          startTime: 10
        },
        {
          id: 'eppa0RXRU-I'  // Nicki Minaj Barbie Tingz
        },
        {
          id: 'kcRWyLMVrFM', // Cardi B Ring
          startTime: 7
        }
      	];
      }



    	fadeOutDuration = 10;
    	currentSong = 0;
    	videoPlayers = [];
    	playerStyle = (DEBUG) ? '' : `style="position: absolute;left:0;"`;

    	// create the divs for the iframes
    	for(j = 0; j < songs.length; j++) {
    		$('body').append(`<div id="player${j}" ${playerStyle}></div>`);
    	}

      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      // var player;
      function onYouTubeIframeAPIReady() {
      	// Instantiate the first two songs
        instantiateYTPlayer(0);
        instantiateYTPlayer(1);

	      // Main loop for switching songs
	      setInterval(checkPlayerStatus, 1000);
      }

      function instantiateYTPlayer(songIndex) {
        // hit end of song list
        if (!songs[songIndex]) {
          return;
        }

        var events = {
          'onReady': function(event) {
            event.target.setPlaybackQuality('hd1080');
          }
        };
        if (songIndex == 0) {
          events = {
            'onReady': function(event) {
              event.target.setPlaybackQuality('hd1080');
              startVideo(event.target, songs[0].startTime, false);
              fadeIn(event.target);
              $(event.target.getIframe()).css('z-index', 100);
            }
          }
        }

        newPlayer = new YT.Player(`player${songIndex}`, {
          height: '100%',
          width: '100%',
          videoId: songs[songIndex].id,
          vq: 'hd1080',
          playerVars: { 
            'rel': 0
          }, 
          events
        });
        videoPlayers.push(newPlayer);
      }

      function checkPlayerStatus() {
      	currentPlayer = videoPlayers[currentSong];
      	if (!currentPlayer || !(typeof currentPlayer.getDuration === 'function')) {
      		return;
      	}

      	songDuration = currentPlayer.getDuration();
      	currentTime = currentPlayer.getCurrentTime();

        // Extra 20 seconds is to avoid the annoying recommended video UI they show at the end
      	endOfSong = songDuration - fadeOutDuration - 20;
      	if (songs[currentSong].endTime) {
      		endOfSong = songs[currentSong].endTime - fadeOutDuration;
      	}

      	// console.log('current time ' + currentTime);
      	// console.log('ending at ' + endOfSong);

      	if (currentTime >= endOfSong) {
      		fadeBetweenPlayers(currentPlayer, videoPlayers[currentSong + 1]);
      	}
      }

			function fadeBetweenPlayers(player1, player2) {
				loadDelay = 3000; // Autoplaying a video will load it, doesn't happen instantly
				// We want to start the new song so it will load, but delay the fade in until it's loaded enough
				currentSong++;

        // Instantiate the video coming up next
        instantiateYTPlayer(currentSong + 1);

        // Start video for the next song        
				startVideo(player2, songs[currentSong].startTime);
				$(player1.getIframe()).css('z-index', 0);
				$(player2.getIframe()).css('z-index', 100);

				setTimeout(function() {
					fadeIn(player2);
          fadeOut(player1);

          setTimeout(function() {
            stopVideo(player1);
          }, fadeOutDuration * 1000);
				}, loadDelay);
			}

      function fadeOutAudio(player) {
      	fadeoutTimer = function() {
      		currentVolume = player.getVolume();
      		if (!player || currentVolume <= 0) {
            console.log('done fading audio');
      			return;
      		} else {
      			player.setVolume(currentVolume - 1);
            setTimeout(fadeoutTimer, 100);
      		}
      	};
        fadeoutTimer();
      }

      function fadeInAudio(player) {
        fadeinTimer = function() {
          currentVolume = player.getVolume();
          if (!player || currentVolume >= 100) {
            console.log('done fading audio');
            return;
          } else {
            player.setVolume(currentVolume + 1);
            setTimeout(fadeinTimer, 100);
          }
        };
        fadeinTimer();
      }

      function stopVideo(player) {
        player.stopVideo();
        //$(player.getIframe()).remove();
        // There is an error if you try to remove the element.
      }

      function startVideo(player, seconds, setVolume = true) {
      	if (seconds) {
      		player.seekTo(seconds);
      	} else {
      		player.playVideo();
      	}

        if (setVolume) {
        	// Set starting video audio volume to 0
        	player.setVolume(0);
        }
      }

			function fadeIn(player) {
				$(player.getIframe()).addClass('fadeIn');
				fadeInAudio(player);
			}
			function fadeOut(player) {
				$(player.getIframe()).addClass('fadeOut');
				fadeOutAudio(player);
			}
    </script>
	</body>
</html>